<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8">
    <title>Login and Registration</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="static/styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
<body>
  <div class="container">
    <input type="checkbox" id="flip">
    <div class="cover">
      <div class="front">
        <img src="../images/social.jpeg" alt="">
        <div class="text">
          <span class="text-1">Every new friend is a <br> new adventure</span>
          <span class="text-2">Let's get connected</span>
        </div>
      </div>
      <div class="back">
        <div class="text">
          <span class="text-1">Complete miles of journey <br> with one step</span>
          <span class="text-2">Let's get started</span>
        </div>
      </div>
    </div>

    <div class="forms">
      <div class="form-content">
        <!-- LOGIN FORM -->
        <div class="login-form">
          <div class="title">Login</div>
          <form id="loginForm">
            <div class="input-boxes">
              <div class="input-box">
                <i class="fas fa-user"></i>
                <input type="text" id="loginUsername" placeholder="Enter your username" required>
              </div>
              <div class="input-box">
                <i class="fas fa-lock"></i>
                <input type="password" id="loginPassword" placeholder="Enter your password" required>
              </div>
              <div class="text"><a href="#">Forgot password?</a></div>
              <div class="button input-box">
                <input type="submit" value="Submit">
              </div>
              <div class="text sign-up-text">Don't have an account? <label for="flip">Signup now</label></div>
            </div>
          </form>
        </div>

        <!-- SIGNUP FORM -->
        <div class="signup-form">
          <div class="title">Signup</div>
          <form id="signupForm">
            <div class="input-boxes">
              <div class="input-box">
                <i class="fas fa-user"></i>
                <input type="text" id="signupUsername" placeholder="Enter your username" required>
              </div>
              <div class="input-box">
                <i class="fas fa-envelope"></i>
                <input type="text" id="signupEmail" placeholder="Enter your email" required>
              </div>
              <div class="input-box">
                <i class="fas fa-lock"></i>
                <input type="password" id="signupPassword" placeholder="Enter your password" required>
              </div>
              <div class="button input-box">
                <input type="submit" value="Submit">
              </div>
              <div class="text sign-up-text">Already have an account? <label for="flip">Login now</label></div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- JS Logic -->
  <script src="api.js"></script>
<script>
  const API_BASE_URL = "https://animediabackend.onrender.com";

  // Generic API request helper
  async function apiRequest(endpoint, method = "GET", body = null) {
    const options = {
      method,
      headers: {
        "Content-Type": "application/json",
      },
    };
  
    if (body) options.body = JSON.stringify(body);
  
    const response = await fetch(`${API_BASE_URL}${endpoint}`, options);
  
    if (!response.ok) {
      const errorData = await response.json().catch(() => ({}));
      throw new Error(errorData.detail || "Request failed");
    }
  
    return response.json();
  }
  
  // Signup function
  async function signup(username, email, password) {
    try {
      const data = await apiRequest("/auth/signup", "POST", {
        username,
        email,
        password,
      });
  
      alert("✅ Signup successful! Please log in.");
      console.log("Signup success:", data);
    } catch (err) {
      console.error("Signup error:", err);
      alert("❌ Signup error: " + err.message);
    }
  }
  
  // Login
  async function login(username, password) {
    try {
      const response = await fetch("https://animediabackend.onrender.com/auth/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password })
      });
  
      if (!response.ok) throw new Error("Login failed");
  
      const data = await response.json();
  
      // Save token to localStorage
      localStorage.setItem("token", data.access_token);
  
      // Alert then redirect
      alert("Login successful! Redirecting...");
      window.location.href = "template/Home_page.html"; // redirect after alert
  
      console.log("Login:", data);
    } catch (err) {
      console.error(err);
      alert("Login error: " + err.message);
    }
  }
  
  // Attach form events
  document.getElementById("loginForm").addEventListener("submit", (e) => {
    e.preventDefault();
    const username = document.getElementById("loginUsername").value;
    const password = document.getElementById("loginPassword").value;
    login(username, password);
  });

  document.getElementById("signupForm").addEventListener("submit", (e) => {
    e.preventDefault();
    const username = document.getElementById("signupUsername").value;
    const email = document.getElementById("signupEmail").value;
    const password = document.getElementById("signupPassword").value;
    signup(username, email, password);
  });
</script>

</body>
</html>
